// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<20x20xui8> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0 = call @inputs() : () -> tensor<20x20xui8>
    %1 = call @expected() : () -> tensor<20x20xui8>
    %c = stablehlo.constant dense<0> : tensor<ui8>
    %2 = stablehlo.broadcast_in_dim %c, dims = [] : (tensor<ui8>) -> tensor<20x20xui8>
    %3 = stablehlo.compare  EQ, %0, %2,  UNSIGNED : (tensor<20x20xui8>, tensor<20x20xui8>) -> tensor<20x20xi1>
    %c_0 = stablehlo.constant dense<0> : tensor<ui8>
    %4 = stablehlo.broadcast_in_dim %c_0, dims = [] : (tensor<ui8>) -> tensor<20x20xui8>
    %c_1 = stablehlo.constant dense<1> : tensor<ui8>
    %5 = stablehlo.broadcast_in_dim %c_1, dims = [] : (tensor<ui8>) -> tensor<20x20xui8>
    %6 = stablehlo.select %3, %4, %5 : tensor<20x20xi1>, tensor<20x20xui8>
    stablehlo.custom_call @check.expect_eq(%6, %1) {has_side_effect = true} : (tensor<20x20xui8>, tensor<20x20xui8>) -> ()
    return %6 : tensor<20x20xui8>
  }
  func.func private @inputs() -> (tensor<20x20xui8> {mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<"0x03020001050101030501010502040003010203020201000002050102000204010100030404010404010404070100030101000201010103010300000103020105020000000101010002000402010102000100000102020302010501040201010601020200000100010200030200040201000101020306000204000005040302020105000300010302000001020502000201000301040602010000000103050105010500050100040201020301000400020000010004000203020601040200000200050101020205040105030105020202010403000001030001010301000500020301010605000005000201010601020103020001010100010201010105020001010002000300040302000202020102050303070201000100000400010200000504020604010003020005020300030301000102030107010104010003020002050103020300040300000400050403010100020102050202020301050203000300040102020601020600010700000102020403010201070202030000050603020204030202030001000303040004010007"> : tensor<20x20xui8>
    return %c : tensor<20x20xui8>
  }
  func.func private @expected() -> (tensor<20x20xui8> {mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<"0x01010001010101010101010101010001010101010101000001010101000101010100010101010101010101010100010101000101010101010100000101010101010000000101010001000101010101000100000101010101010101010101010101010100000100010100010100010101000101010101000101000001010101010101000100010101000001010101000101000101010101010000000101010101010100010100010101010101000100010000010001000101010101010100000100010101010101010101010101010101010101000001010001010101000100010101010101000001000101010101010101010001010100010101010101010001010001000100010101000101010101010101010101000100000100010100000101010101010001010001010100010101000101010101010101010001010001010101010100010100000100010101010100010101010101010101010101000100010101010101010100010100000101010101010101010101010000010101010101010101010001000101010001010001"> : tensor<20x20xui8>
    return %c : tensor<20x20xui8>
  }
}
