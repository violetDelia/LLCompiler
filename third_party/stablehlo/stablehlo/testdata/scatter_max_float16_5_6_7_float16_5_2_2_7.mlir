// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<5x6x7xf16> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[[[0], [1]], [[2], [3]]]> : tensor<2x2x1xi64>
    %0:2 = call @inputs() : () -> (tensor<5x6x7xf16>, tensor<5x2x2x7xf16>)
    %1 = call @expected() : () -> tensor<5x6x7xf16>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 3], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1], index_vector_dim = 2>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f16>, %arg1: tensor<f16>):
      %3 = stablehlo.maximum %arg0, %arg1 : tensor<f16>
      stablehlo.return %3 : tensor<f16>
    }) : (tensor<5x6x7xf16>, tensor<2x2x1xi64>, tensor<5x2x2x7xf16>) -> tensor<5x6x7xf16>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<5x6x7xf16>, tensor<5x6x7xf16>) -> ()
    return %2 : tensor<5x6x7xf16>
  }
  func.func private @inputs() -> (tensor<5x6x7xf16> {mhlo.layout_mode = "default"}, tensor<5x2x2x7xf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x91C079413A3D1E2FF4407CBFDA43C94317B9A0455744FE38B04490C4BA3FB143853D1641843E0AC4DC382A42BAC27C39EB42ED38AB435CC6D742EB476F42E1419CBE433675C47D42EFC107C11A3E2143C93727C4634495C3C9C36FC310343DB95646CFC4C14491AAAD423741FA4026301FB3E8BB653F3E43D6434DC4C5436A3CADC213448BB7F0B8A140C0C1944155C42F4355BACAC55A3D4A437CB03CB4B1C5203A50C453322137A5BC18C86D42EA3F59C465422D41BC4005C49D415944FDBC6CC3624006B2D63BE1BC34BCCFBDCD454D3B7EC3DCB590BF06454937DC3DFCBBF5C1AAC1ABC4BEBD1443E1C261C1C53E4E426ABF16B98AB6ED4286358AC33D449AB6223DB944663CB0446CB2E0BD8645A84421C313C37840E7421633B6AD38C45743F5BE37431AC15E3CDBACAD405DC03C41964066B02B48573F064686C1F3C3AF4083C8163A1DC116C1E6401E3ED940AEB7FEC06641C5408C361CC50EBE58352C335CC50DBC6FC1D23F17B3733848C48DBFD8C1EC413BC56541893A919DC7399F4326BF3FC7F745183D91BA17BEEA3D2AC4B6C3BFC33B4477C1BDB4F2C22344D8392CC0"> : tensor<5x6x7xf16>
    %cst_0 = stablehlo.constant dense<"0x914090C201C478BAA63578BE5FC0574135C0C83D7038EBC0CAC30BC5C145CE3ED43458B9033F363D3F4169425EC3593448B7A53D67C14BC7D93FA5C3BBBDEA4217C21C34B3C10C35B6C52B3767B1AAC5C4C026416EC4EE40F7B9A5BCB637DDC56143EE3EDB408AC39B41F9B0C5C4BA40193D01C4C93D0042154434BEFFC19B373CC6A4C42BB8B4C2D03B5CAE13B833BE49335D3D75BCC4BBAA41744232C3363FBCBBCCBF472F2346FE4093300A3CF6BB36C3BCC5C944AA3BECC620412E41414349C716432844F044DEC30443F4403641B7BAF0BCF043D1BB65BF34444DB837C5DF3920411AC6BA420B3FF8C40DBAFCC4B341864192402A3B22BF29C1073570C0FD40BFBCB13C30428D410541A8C053BF3F41F7C05B3968C4"> : tensor<5x2x2x7xf16>
    return %cst, %cst_0 : tensor<5x6x7xf16>, tensor<5x2x2x7xf16>
  }
  func.func private @expected() -> (tensor<5x6x7xf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x914079413A3D1E2FF44078BEDA43C94317B9A0455744FE38B04490C4C145B143853D1641033F363D3F416942BAC27C39EB42A53DAB435CC6D742EB476F42E1419CBE433675C47D42EFC107C11A3E2143C93727C4634495C3BBBDEA4210341C3456460C35C1442B37AD423741FA4026411FB3EE40653F3E43D6434DC4C543EE3EDB4013449B41F9B0A140BA40944155C42F4355BACAC55A3D4A437CB03CB4B1C5203A50C453322137193D01C46D420042154465422D41BC4005C49D415944FDBCD03B624006B2D63B49335D3D75BCCD45AA417442DCB5363F06454937DC3D2346F5C1AAC1ABC4BEBD1443E1C261C1C53E4E426ABF16B98AB6ED428635FE403D440A3C223DB944663CC944AA3BE0BD8645A844414313C316432844F044B6AD0443574336413743F0BCF043DBACAD4034443C41964066B02B48573F064686C1F3C3AF4083C8163A1DC116C1E6401E3ED940DF3920416641BA420B3FF8C40DBA5835B341864192402A3BD23F17B3733870C0FD40BFBCEC4130428D410541919DC7399F4326BF5B39F745183D91BA17BEEA3D2AC4B6C3BFC33B4477C1BDB4F2C22344D8392CC0"> : tensor<5x6x7xf16>
    return %cst : tensor<5x6x7xf16>
  }
}
