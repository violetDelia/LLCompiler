// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<20x20xui8> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0:2 = call @inputs() : () -> (tensor<20x20xui8>, tensor<20x20xui8>)
    %1 = call @expected() : () -> tensor<20x20xui8>
    %2 = stablehlo.maximum %0#0, %0#1 : tensor<20x20xui8>
    stablehlo.custom_call @check.expect_eq(%2, %1) {has_side_effect = true} : (tensor<20x20xui8>, tensor<20x20xui8>) -> ()
    return %2 : tensor<20x20xui8>
  }
  func.func private @inputs() -> (tensor<20x20xui8> {mhlo.layout_mode = "default"}, tensor<20x20xui8> {mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<"0x02000201010003000300010200040005000403080300000002000300000201010004000304040104000203030205010602010101010001060200050301000302010303020200030400020301010302000601020102030303000002020000010105020200020502000501040604030003050403000102010306000300040002010304060500020200020005030102000001010101000202030401010200000200000002010003040003060105000300030300020200000403000306010502030501030401020204000102000503020102050103010102000101020000040405000101000300020303010300040305070001020102020202020400010500010102000100010100040102000000000002010005000101030103040101020103010200020302050100050001010301020104010005010000020002020204020202010002060601030702010104010002060201040200070202000304050104030501020104030101040200020507030002020202030101030002040400020600010003030000040101000200020006020000"> : tensor<20x20xui8>
    %c_0 = stablehlo.constant dense<"0x02020000050100000103000202000105060002010101050105000102030001030001010301000100010203020001040800010004050100070300020507010001030005010401000302040007060000010400030100000302010203000001000303010001020102050202050202030101000100020001020000040007030104040002010201000100050305020102010104000402040100000300030201020305030202000204010100020200030002050002000203000000000304000003050001070201060401000200010004010100000007000703010202040301010201010100000506000004000201030000000001020000030000030500000100000100010104000602040205010200030007010000040301030000010202060301010004020300050006000200040502000103030003020002000503000102020203000402050002000401020200020102010500010400020003000003010102010004000000010005020100050002020303000600020200020203010300050102010102000305020001080100030001050100"> : tensor<20x20xui8>
    return %c, %c_0 : tensor<20x20xui8>, tensor<20x20xui8>
  }
  func.func private @expected() -> (tensor<20x20xui8> {mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<"0x02020201050103000303010202040105060403080301050105000302030201030004010304040104010203030205040802010104050101070300050507010302030305020401030402040307060302010601030102030303010203020001010305020201020502050502050604030103050403020102020306040307040104040304060501020200050305030102010104010402040202030401030201020305030202010204040103060205030302050302020203000403000306010503050501070401060404000202010504020102050107010703010202040301040405010101000506020304010301040305070001020102030202030500010500010102010104010602040205010200030007010005040301030103040202060303010204020302050106050201040502020104030005020002020503020204020203010402060602030702020204020102060501040400070203000304050104030504020104030105040200050507030303020602030201030203040400050602010103030305040101080200030006050100"> : tensor<20x20xui8>
    return %c : tensor<20x20xui8>
  }
}
